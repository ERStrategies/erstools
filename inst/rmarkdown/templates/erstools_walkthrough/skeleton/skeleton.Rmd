---
title: "erstools walkthrough"
author: "Zach Friedman"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_depth: 3   # Customize the depth of the table of contents for HTML document
    toc_float:
      collapsed: true    # Start with the table of contents expanded
      smooth_scroll: true  # Enable smooth scrolling
knit: (function(inputFile, encoding) {
  rmarkdown::render(inputFile, encoding = encoding,
  output_dir = "knitted files", output_format = "all") })
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Part 0: Read Libraries and connect to Sharepoint

## 0.1 (OPTIONAL) Install the latest version of the erstools library!

**ACTION: If you aren't sure if you have the most up to date release of erstools, follow these instructions: <https://app.tettra.co/teams/ersknowledge/pages/updating-erstools-functions-markdown-template>**

**And if you've never installed erstools go here: <https://app.tettra.co/teams/ersknowledge/pages/downloading-erstools-package-and-the-rmarkdown-template>**

## 0.2 Read All Libraries

```{r}
ers_load_packages()
options(scipen = 99) #prevent any numbers from showing up as scientific notation
```

# Part 1: Bring in your data

## 1.0 Authenticate to sharepoint to be able to read in files

**ACTION: After running the code, you may need to look at your console code window below for instructions to log in. A window may open in your browser to ask you to log into Microsoft to confirm your identity**

**NOTE: If you ever have authentication issues, first run this in your console then try running the code chunk below again - AzureAuth::clean_token_directory()**

```{r}
#set sharepoint site URL for access to our org-wide files
orgfiles_site_url <- "https://erstrategies1.sharepoint.com/sites/orgfiles"
#access sharepoint site URL you may be prompted to sign in here
orgfiles_site <- get_sharepoint_site(site_url = orgfiles_site_url)
```

## 1.1 Set your folder path(s)

**ACTION: Change the raw_data_folder_path to the path to your data: <https://app.tettra.co/teams/ersknowledge/pages/copying-a-folder-path-from-sharepoint-to-use-in-r>**

```{r}
raw_data_folder_path <- "https://erstrategies1.sharepoint.com/sites/orgfiles/Client%20Work/District%20Partners/Columbus%20City/22-23%20Financial%20Equity%20&%20Funding%20System%20Design/1.%20Data%20&%20Analysis%20-%20Secure/Raw%20Data%20for%20R"
```

## 1.2 See guidance on using the "ers_read_sharepoint" function

**ACTION: Run the code below to see documentation on our custom function!**

```{r, eval = interactive()}
?ers_read_sharepoint
```

## 1.3 Read in your data

**ACTION: Replace "raw_data" with the desired name of your data frame and replace "XXX.XXX" with the file name plus extension.**

```{r}
raw_data <- ers_read_sharepoint(folder_path = raw_data_folder_path,
                   file_name_with_extension = "XXX.XXX")
```

## 1.4 View your data

**ACTION:**

**Replace "raw_data" with the same name of your data frame you used above.**

**Run the code to inspect your data in either the Rmarkdown script (first line of code) or a separate view tab using View(raw_data)**

```{r, eval = interactive()}
raw_data
```

# Part 2: Validate Data

## 2.0 Check out the ers_column_info function as a starting place in your data validation (credits to Mauro!)

**ACTION: Run the code below to see documentation on our custom function!**

```{r, eval = interactive()}
?ers_column_info
```

## 2.1 Run ers_column_info on your data

**ACTION: Replace "raw_data" with the name of your data frame**

```{r}
ers_column_info(raw_data)
```

# Part 3: Process your data (more to come here later)

# Part 4: Analyze/view your data

## 4.0 Check out the ers_table function to make your tables nice using the gt package. (credits to Mauro!)

**ACTION: Run the code below to see documentation on our custom function!**

```{r, eval = interactive()}
?ers_table
```

## 4.1 Run ers_table on your data

**ACTION: Replace "example_analysis_table" with the name of processed analysis output you want to display nicely and XXX with the desired title of your table. NEVER RUN THIS FUNCTION ON MORE THAN 100 LINES OF DATA BECAUSE IT WILL BE VERY SLOW. THIS IS NOT MEANT TO BE USED ON YOUR ENTIRE DATA FRAME**

```{r}
ers_table(dataset = example_analysis_table, title = "XXX")
```

# Part 5: Upload File to Sharepoint

## 5.1 Set output data folder Path

**ACTION: Change the processed_data_folder_path to the path to your data: <https://app.tettra.co/teams/ersknowledge/pages/copying-a-folder-path-from-sharepoint-to-use-in-r>**

```{r}
processed_data_folder_path <- "https://erstrategies1.sharepoint.com/sites/orgfiles/Client%20Work/District%20Partners/Columbus%20City/22-23%20Financial%20Equity%20&%20Funding%20System%20Design/1.%20Data%20&%20Analysis%20-%20Secure/Processed%20Data%20for%20R"
```

## 5.2 See guidance on using the "ers_write_sharepoint" function

**ACTION: Run the code below to see documentation on our custom function!**

```{r, eval = interactive()}
?ers_write_sharepoint
```

## 5.3 Write files

**ACTION: Replace XXX with your desired name of your data and replace "XXX.csv" with the desired name of your output file. You can output CSV or XLSX files**

```{r eval = FALSE}
#Example
ers_write_sharepoint(data = XXX,
                     folder_path = processed_data_folder_path,
                     file_name_with_extension = "XXX.csv")
```

# Part 6: Knit the file into a nicely formatted HTML that you can share with teammates!

**ACTION: ALL YOU NEED TO DO IS Use Ctrl+Shift+K to knit your file, and it will upload an html file to your Github repo in a folder called "knitted files"!**

